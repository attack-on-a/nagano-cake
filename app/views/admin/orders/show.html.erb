<div class="container">
 <div class="row">
  <div class="col-md-12">
    <h4 class="p-3 mb-2 bg-secondary text-white">注文履歴詳細</h4>

      <table class="table table-striped">
       <tbody>
        <tr>
          <td>購入者</td>
          <td>
            <%= link_to admin_customer_path(@order.customer_id), @customer.first_name + @customer.last_name  %>
          </td>
        </tr>

        <tr>
           <td>注文日</td>
           <td> <%= @order.created_at.strftime('%Y/%m/%d') %> </td>
        </tr>

         <tr>
           <td>配送先</td>
           <td> 〒<%= @order.post_code %>
               <%= @order.address %><br>
               <%= @order.name %>
           </td>
         </tr>

         <tr>
           <td> 支払い方法</td>
           <td> <%= @order.payment %> </td>
         </tr>

         <tr>
            <td>注文ステータス</td>
            <td><%= form_with model: @order, url: admin_order_path, method: :patch do |f| %>
              <%= f.select :status, Order.statuses.keys.map {|k| [I18n.t("enums.order.order_status.#{k}"), k]} %>
              <%= f.submit "更新",class:"btn btn-success" %>
              <% end %>
            </td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>

      <div class="row mb-5">
        <div class="col-md-8">
          <table class="table">
            <thead class="bg-secondary text-white">
             <tr>
              <th>商品名</th>
              <th>単価(税込み)</th>
              <th>数量</th>
              <th>小計</th>
              <th>制作ステータス</th>
             </tr>
            </thead>

            <tbody>
             <% @order_details.each do |order_detail| %>
             <tr>
              <td><%= order_detail.item.name %> </td>
              <td><%= (order_detail.price * 1.1).floor %> </td>
              <td><%= order_detail.amount %> </td>
              <td><%= (order_detail.price * 1.1).floor * order_detail.amount %> </td>
              <td>
                 <%= form_with model: order_detail, url: admin_ordered_item_path(order_detail), method: :patch do |f| %>
                 <%= f.select :production_status, OrderDetail.production_statuses.keys.map {|k| [I18n.t("enums.order_detail.production_status.#{k}"), k]} %>
                 <!--参考資料  https://blog.to-ko-s.com/enum-select-box/ -->
                 <%= f.submit "更新", class: "btn btn-success" %>
                 <% end %>
              </td>
             </tr>
             <% end %>
            </tbody>
          </table>
        </div>

       <div class="col-md-4">
         <table class="table">
          <tbody>
           <tr>
             <td>商品合計</td>
             <td> <%= @order.total - @order.postage %>  </td>
           </tr>
           <tr>
             <td>配送料</td>
             <td><%= @order.postage %></td>
           </tr>
           <tr>
             <td>ご請求額</td>
             <td><%= @order.total %></td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
  </div>

